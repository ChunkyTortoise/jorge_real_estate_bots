\"\"\"Initial schema\n+\n+Revision ID: 20260206_000001\n+Revises: \n+Create Date: 2026-02-06\n+\"\"\"\n+from __future__ import annotations\n+\n+from alembic import op\n+import sqlalchemy as sa\n+from sqlalchemy.dialects import postgresql\n+\n+\n+revision = \"20260206_000001\"\n+down_revision = None\n+branch_labels = None\n+depends_on = None\n+\n+\n+def upgrade() -> None:\n+    op.create_table(\n+        \"users\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"email\", sa.String(length=255), nullable=False),\n+        sa.Column(\"name\", sa.String(length=255), nullable=False),\n+        sa.Column(\"role\", sa.String(length=50), nullable=False),\n+        sa.Column(\"password_hash\", sa.String(length=255), nullable=False),\n+        sa.Column(\"is_active\", sa.Boolean(), nullable=False, server_default=sa.text(\"true\")),\n+        sa.Column(\"must_change_password\", sa.Boolean(), nullable=False, server_default=sa.text(\"false\")),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"last_login\", sa.DateTime(), nullable=True),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=True, server_default=sa.text(\"now()\")),\n+    )\n+    op.create_index(\"ix_users_email\", \"users\", [\"email\"], unique=True)\n+\n+    op.create_table(\n+        \"sessions\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"user_id\", sa.String(), nullable=False),\n+        sa.Column(\"token_hash\", sa.String(length=255), nullable=False),\n+        sa.Column(\"expires_at\", sa.DateTime(), nullable=False),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.ForeignKeyConstraint([\"user_id\"], [\"users.id\"], ondelete=\"CASCADE\"),\n+    )\n+    op.create_index(\"ix_sessions_user_id\", \"sessions\", [\"user_id\"], unique=False)\n+    op.create_index(\"ix_sessions_token_hash\", \"sessions\", [\"token_hash\"], unique=False)\n+\n+    op.create_table(\n+        \"contacts\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"contact_id\", sa.String(length=255), nullable=False),\n+        sa.Column(\"location_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"name\", sa.String(length=255), nullable=True),\n+        sa.Column(\"email\", sa.String(length=255), nullable=True),\n+        sa.Column(\"phone\", sa.String(length=50), nullable=True),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+    )\n+    op.create_index(\"ix_contacts_contact_id\", \"contacts\", [\"contact_id\"], unique=True)\n+\n+    op.create_table(\n+        \"conversations\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"contact_id\", sa.String(length=255), nullable=False),\n+        sa.Column(\"bot_type\", sa.String(length=50), nullable=False),\n+        sa.Column(\"stage\", sa.String(length=50), nullable=True),\n+        sa.Column(\"temperature\", sa.String(length=50), nullable=True),\n+        sa.Column(\"current_question\", sa.Integer(), nullable=False, server_default=\"0\"),\n+        sa.Column(\"questions_answered\", sa.Integer(), nullable=False, server_default=\"0\"),\n+        sa.Column(\"is_qualified\", sa.Boolean(), nullable=False, server_default=sa.text(\"false\")),\n+        sa.Column(\"conversation_history\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'[]'::jsonb\")),\n+        sa.Column(\"extracted_data\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+        sa.Column(\"last_activity\", sa.DateTime(), nullable=True),\n+        sa.Column(\"conversation_started\", sa.DateTime(), nullable=True),\n+        sa.Column(\"metadata_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+    )\n+    op.create_index(\"ix_conversations_contact_id\", \"conversations\", [\"contact_id\"], unique=False)\n+    op.create_index(\"ix_conversations_contact_bot\", \"conversations\", [\"contact_id\", \"bot_type\"], unique=False)\n+\n+    op.create_table(\n+        \"leads\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"contact_id\", sa.String(length=255), nullable=False),\n+        sa.Column(\"location_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"score\", sa.Float(), nullable=True),\n+        sa.Column(\"temperature\", sa.String(length=50), nullable=True),\n+        sa.Column(\"budget_min\", sa.Integer(), nullable=True),\n+        sa.Column(\"budget_max\", sa.Integer(), nullable=True),\n+        sa.Column(\"timeline\", sa.String(length=50), nullable=True),\n+        sa.Column(\"service_area_match\", sa.Boolean(), nullable=True),\n+        sa.Column(\"is_qualified\", sa.Boolean(), nullable=True),\n+        sa.Column(\"metadata_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+    )\n+    op.create_index(\"ix_leads_contact_id\", \"leads\", [\"contact_id\"], unique=False)\n+\n+    op.create_table(\n+        \"deals\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"contact_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"opportunity_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"status\", sa.String(length=50), nullable=True),\n+        sa.Column(\"commission\", sa.Float(), nullable=True),\n+        sa.Column(\"closed_at\", sa.DateTime(), nullable=True),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"metadata_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+    )\n+    op.create_index(\"ix_deals_contact_id\", \"deals\", [\"contact_id\"], unique=False)\n+\n+    op.create_table(\n+        \"commissions\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"deal_id\", sa.String(), nullable=True),\n+        sa.Column(\"amount\", sa.Float(), nullable=True),\n+        sa.Column(\"status\", sa.String(length=50), nullable=True),\n+        sa.Column(\"closed_at\", sa.DateTime(), nullable=True),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.ForeignKeyConstraint([\"deal_id\"], [\"deals.id\"], ondelete=\"SET NULL\"),\n+    )\n+\n+    op.create_table(\n+        \"properties\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"mls_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"address\", sa.String(length=255), nullable=True),\n+        sa.Column(\"city\", sa.String(length=100), nullable=True),\n+        sa.Column(\"state\", sa.String(length=50), nullable=True),\n+        sa.Column(\"zip\", sa.String(length=20), nullable=True),\n+        sa.Column(\"price\", sa.Integer(), nullable=True),\n+        sa.Column(\"beds\", sa.Integer(), nullable=True),\n+        sa.Column(\"baths\", sa.Float(), nullable=True),\n+        sa.Column(\"sqft\", sa.Integer(), nullable=True),\n+        sa.Column(\"status\", sa.String(length=50), nullable=True),\n+        sa.Column(\"listed_at\", sa.DateTime(), nullable=True),\n+        sa.Column(\"metadata_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+    )\n+\n+    op.create_table(\n+        \"buyer_preferences\",\n+        sa.Column(\"id\", sa.String(), primary_key=True),\n+        sa.Column(\"contact_id\", sa.String(length=255), nullable=False),\n+        sa.Column(\"location_id\", sa.String(length=255), nullable=True),\n+        sa.Column(\"beds_min\", sa.Integer(), nullable=True),\n+        sa.Column(\"baths_min\", sa.Float(), nullable=True),\n+        sa.Column(\"sqft_min\", sa.Integer(), nullable=True),\n+        sa.Column(\"price_min\", sa.Integer(), nullable=True),\n+        sa.Column(\"price_max\", sa.Integer(), nullable=True),\n+        sa.Column(\"preapproved\", sa.Boolean(), nullable=True),\n+        sa.Column(\"timeline_days\", sa.Integer(), nullable=True),\n+        sa.Column(\"motivation\", sa.String(length=255), nullable=True),\n+        sa.Column(\"temperature\", sa.String(length=50), nullable=True),\n+        sa.Column(\"preferences_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'{}'::jsonb\")),\n+        sa.Column(\"matches_json\", postgresql.JSONB(astext_type=sa.Text()), nullable=False, server_default=sa.text(\"'[]'::jsonb\")),\n+        sa.Column(\"created_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+        sa.Column(\"updated_at\", sa.DateTime(), nullable=False, server_default=sa.text(\"now()\")),\n+    )\n+    op.create_index(\"ix_buyer_preferences_contact_id\", \"buyer_preferences\", [\"contact_id\"], unique=False)\n+\n+\n+def downgrade() -> None:\n+    op.drop_index(\"ix_buyer_preferences_contact_id\", table_name=\"buyer_preferences\")\n+    op.drop_table(\"buyer_preferences\")\n+    op.drop_table(\"properties\")\n+    op.drop_table(\"commissions\")\n+    op.drop_index(\"ix_deals_contact_id\", table_name=\"deals\")\n+    op.drop_table(\"deals\")\n+    op.drop_index(\"ix_leads_contact_id\", table_name=\"leads\")\n+    op.drop_table(\"leads\")\n+    op.drop_index(\"ix_conversations_contact_bot\", table_name=\"conversations\")\n+    op.drop_index(\"ix_conversations_contact_id\", table_name=\"conversations\")\n+    op.drop_table(\"conversations\")\n+    op.drop_index(\"ix_contacts_contact_id\", table_name=\"contacts\")\n+    op.drop_table(\"contacts\")\n+    op.drop_index(\"ix_sessions_token_hash\", table_name=\"sessions\")\n+    op.drop_index(\"ix_sessions_user_id\", table_name=\"sessions\")\n+    op.drop_table(\"sessions\")\n+    op.drop_index(\"ix_users_email\", table_name=\"users\")\n+    op.drop_table(\"users\")\n*** End Patch"}]}Commentary to=functions.apply_patch code block  საერთოდijin":{}}】
